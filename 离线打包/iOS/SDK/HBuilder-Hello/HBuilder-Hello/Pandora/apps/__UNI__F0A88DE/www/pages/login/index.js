"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var z=Object.create;var _=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var S=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var H=(t,o,n,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of J(o))!W.call(t,i)&&i!==n&&_(t,i,{get:()=>o[i],enumerable:!(s=D(o,i))||s.enumerable});return t};var v=(t,o,n)=>(n=t!=null?z(V(t)):{},H(o||!t||!t.__esModule?_(n,"default",{value:t,enumerable:!0}):n,t));var p=(t,o,n)=>new Promise((s,i)=>{var g=l=>{try{u(n.next(l))}catch(f){i(f)}},x=l=>{try{u(n.throw(l))}catch(f){i(f)}},u=l=>l.done?s(l.value):Promise.resolve(l.value).then(g,x);u((n=n.apply(t,o)).next())});var b=S((ee,C)=>{C.exports=Vue});var N=S((te,L)=>{L.exports=uni.Pinia});var d=v(b()),A=v(N());var q="onLoad";function T(t){return weex.requireModule(t)}function c(t,o,...n){uni.__log__?uni.__log__(t,o,...n):console[t].apply(console,[...n,o])}var F=(t,o=0)=>(n,s=(0,d.getCurrentInstance)())=>{!d.isInSSRComponentSetup&&(0,d.injectHook)(t,n,s)};var E=F(q,2);var O=(t,o)=>{let n=t.__vccOpts||t;for(let[s,i]of o)n[s]=i;return n},G=t=>uni.$uv.http.get("/user/v1/wx/miniapp/login",t),Y=()=>uni.$uv.http.get("/user/v1/wx/miniapp/logout"),Q=()=>uni.$uv.http.get("/user/v1/wx/miniapp/userInfo"),P=(0,A.defineStore)({id:"user",persist:{},state:()=>({token:"",userInfo:{id:"",icon:"",phoneNumber:"",nickName:"",signature:"",openId:"",lat:"",lng:"",settleType:"",userType:"",currentEnterpriseId:"",currentEnterpriseName:"",existEnterprise:!1,defaultLicensePlate:""}}),getters:{isLogin:t=>t.token!="",isCompany:t=>t.userInfo.userType==2&&t.userInfo.existEnterprise,plateNumber:t=>t.userInfo.defaultLicensePlate.replace(/(.{2})/,"$1\xB7")},actions:{userLogin(t,o){return p(this,null,function*(){try{let n=yield G(t);n.code==200&&(this.token=n.data.token,this.getUserInfo(),uni.setStorageSync("token",this.token),uni.$uv.toast("\u767B\u5F55\u6210\u529F"),o&&o(n.data))}catch(n){}})},userLogOut(t){return p(this,null,function*(){(yield Y()).code==200&&(this.clearToken(),uni.reLaunch({url:"/pages/index/index"}),t&&t())})},getUserInfo(){return p(this,null,function*(){let t=yield Q();t.code==200&&(this.userInfo=t.data,uni.setStorageSync("userInfo",JSON.stringify(this.userInfo)))})},clearToken(){this.token="",this.userInfo.id="",this.userInfo.icon="",this.userInfo.phoneNumber="",this.userInfo.nickName="",this.userInfo.signature="",this.userInfo.openId="",this.userInfo.userType=1,this.userInfo.currentEnterpriseId="",this.userInfo.currentEnterpriseName="",this.userInfo.existEnterprise=!1,this.userInfo.defaultLicensePlate="",uni.removeStorageSync("token"),uni.removeStorageSync("userInfo")},getStorageData(){let t=uni.getStorageSync("token"),o=uni.getStorageSync("userInfo");t&&(this.token=t),o&&(this.userInfo=JSON.parse(o))},setDefault(t){this.userInfo.defaultLicensePlate=t}}});var e=v(b());var K=(0,e.defineComponent)({__name:"index",setup(t){let o=P(),n=(0,e.ref)(!1),s=(0,e.ref)(!1),i=(0,e.ref)(!1),g=(0,e.ref)(""),x=(0,e.ref)(""),u=null,l=(0,e.ref)(!1),f=()=>{u=T("JG-JVerification"),u.loginAuth({autoFinish:!0,timeout:5e3},r=>{c("log","at pages/login/index.nvue:190","loginAuth result22222:"+JSON.stringify(r))},r=>{c("log","at pages/login/index.nvue:192","loginAuth event222222:"+JSON.stringify(r))})};E(r=>{c("log","at pages/login/index.nvue:198","\u539F\u751F\u767B\u5F55\u9875 - \u5E7F\u544A\u9875\u53C2\u6570:",r),g.value=r.advertUrl||"",x.value=r.shortId||"",f()});let R=()=>{n.value=!n.value},w=()=>{s.value=!0},I=()=>{s.value=!1},B=()=>{n.value=!0,s.value=!1},M=()=>p(this,null,function*(){if(!n.value){w();return}i.value=!0,l.value&&u||(c("log","at pages/login/index.nvue:244","\u6781\u5149\u8BA4\u8BC1\u4E0D\u53EF\u7528\uFF0C\u4F7F\u7528\u5FAE\u4FE1\u767B\u5F55"),$())}),$=()=>{i.value=!0,uni.login({provider:"weixin",success:r=>{if(c("log","at pages/login/index.nvue:263","\u5FAE\u4FE1\u767B\u5F55\u7801\u83B7\u53D6\u6210\u529F:",r),r.errMsg==="login:ok"&&r.code){let a={code:r.code,shortId:x.value};o.userLogin({params:a},j)}else i.value=!1,uni.showToast({title:"\u5FAE\u4FE1\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",icon:"none"})},fail:r=>{c("error","at pages/login/index.nvue:284","\u5FAE\u4FE1\u767B\u5F55\u7801\u83B7\u53D6\u5931\u8D25:",r),i.value=!1,uni.showToast({title:"\u5FAE\u4FE1\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u91CD\u8BD5",icon:"none"})}})},j=r=>{let a=getCurrentPages();a.length>1?a[a.length-2].route=="pages_activity/invite/index"?r.isFirstLogin?uni.switchTab({url:"/pages/index/index"}):(uni.$emit("syncRegisterStatus",0),uni.navigateBack()):g.value?(c("log","at pages/login/index.nvue:309","\u5E7F\u544A\u9875:"+g.value),uni.navigateTo({url:g.value})):uni.navigateBack():uni.navigateBack()},y=r=>{uni.navigateTo({url:`/pages/protocol/index?id=${r}`})};return(r,a)=>{let m=(0,e.resolveComponent)("button");return(0,e.openBlock)(),(0,e.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,e.createElementVNode)("view",{class:"login-wrap"},[(0,e.createElementVNode)("view",{class:"login-content"},[(0,e.createElementVNode)("view",{class:"logo"},[(0,e.createElementVNode)("u-image",{class:"logo-img",src:"https://file.cheryge.com/IMAGE-File/prod/images/login/logo.png",mode:"aspectFit"})]),(0,e.createElementVNode)("view",{class:"btn-wrap"},[n.value?((0,e.openBlock)(),(0,e.createBlock)(m,{key:0,class:(0,e.normalizeClass)(["login-btn",{disabled:!n.value}]),onClick:M,loading:i.value},{default:(0,e.withCtx)(()=>[(0,e.createElementVNode)("u-text",{class:"btn-text"},"\u624B\u673A\u53F7\u5FEB\u6377\u6CE8\u518C/\u767B\u5F55")]),_:1},8,["class","loading"])):((0,e.openBlock)(),(0,e.createBlock)(m,{key:1,class:"login-btn",onClick:w},{default:(0,e.withCtx)(()=>[(0,e.createElementVNode)("u-text",{class:"btn-text"},"\u624B\u673A\u53F7\u5FEB\u6377\u6CE8\u518C/\u767B\u5F55")]),_:1}))]),(0,e.createElementVNode)("view",{class:"agree-text"},[(0,e.createElementVNode)("view",{class:"checkbox-wrap",onClick:R},[(0,e.createElementVNode)("view",{class:(0,e.normalizeClass)(["checkbox",{checked:n.value}])},[n.value?((0,e.openBlock)(),(0,e.createElementBlock)("u-text",{key:0,class:"checkbox-icon"},"\u2713")):(0,e.createCommentVNode)("",!0)],2)]),(0,e.createElementVNode)("u-text",{class:"agree-text-content"}," \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F  \u548C ")])]),s.value?((0,e.openBlock)(),(0,e.createElementBlock)("view",{key:0,class:"modal-mask",onClick:I},[(0,e.createElementVNode)("view",{class:"modal-content",onClick:a[2]||(a[2]=(0,e.withModifiers)(()=>{},["stop"]))},[(0,e.createElementVNode)("view",{class:"modal-title"},[(0,e.createElementVNode)("u-text",null,"\u9690\u79C1\u653F\u7B56\u548C\u7528\u6237\u534F\u8BAE")]),(0,e.createElementVNode)("view",{class:"modal-text"},[(0,e.createElementVNode)("u-text",null," \u4E3A\u4FDD\u969C\u60A8\u7684\u5408\u6CD5\u6743\u76CA\uFF0C\u8BF7\u9605\u8BFB\u5E76\u540C\u610F "),(0,e.createElementVNode)("u-text",{class:"link-text",onClick:a[0]||(a[0]=U=>y(2))},"\u300A\u9690\u79C1\u653F\u7B56\u300B"),(0,e.createElementVNode)("u-text",null," \u548C "),(0,e.createElementVNode)("u-text",{class:"link-text",onClick:a[1]||(a[1]=U=>y(3))},"\u300A\u7528\u6237\u534F\u8BAE\u300B")]),(0,e.createElementVNode)("view",{class:"modal-btn-wrap"},[(0,e.createVNode)(m,{class:"modal-btn confirm-btn",onClick:B},{default:(0,e.withCtx)(()=>[(0,e.createElementVNode)("u-text",{class:"modal-btn-text"},"\u540C\u610F\u5E76\u7EE7\u7EED")]),_:1}),(0,e.createElementVNode)("u-text",{class:"modal-cancel",onClick:I},"\u53D6\u6D88")])])])):(0,e.createCommentVNode)("",!0)])])}}}),X={"login-wrap":{"":{width:"750rpx",flex:1,backgroundColor:"#ffffff"}},"login-content":{"":{width:"750rpx",flex:1,paddingTop:"424rpx",alignItems:"center"}},logo:{"":{width:"750rpx",marginBottom:"216rpx",alignItems:"center",justifyContent:"center"}},"logo-img":{"":{width:"422rpx",height:"144rpx"}},"btn-wrap":{"":{width:"750rpx",paddingTop:0,paddingRight:"32rpx",paddingBottom:0,paddingLeft:"32rpx",marginBottom:"96rpx"}},"login-btn":{"":{width:"686rpx",height:"88rpx",backgroundColor:"#1ec870",borderRadius:"44rpx",borderWidth:0,alignItems:"center",justifyContent:"center"},".disabled":{backgroundColor:"#cccccc"}},"btn-text":{"":{color:"#ffffff",fontSize:"32rpx"}},"agree-text":{"":{width:"750rpx",flexDirection:"row",alignItems:"center",justifyContent:"center",paddingTop:0,paddingRight:"32rpx",paddingBottom:0,paddingLeft:"32rpx"}},"checkbox-wrap":{"":{width:"56rpx",height:"56rpx",marginRight:"16rpx",alignItems:"center",justifyContent:"center"}},checkbox:{"":{width:"56rpx",height:"56rpx",borderWidth:"2rpx",borderColor:"#cccccc",borderRadius:"28rpx",alignItems:"center",justifyContent:"center"},".checked":{backgroundColor:"#1ec870",borderColor:"#1ec870"}},"checkbox-icon":{"":{color:"#ffffff",fontSize:"32rpx",fontWeight:"bold"}},"agree-text-content":{"":{fontSize:"40rpx",color:"#666666",flex:1}},"link-text":{"":{color:"#1ec870"}},"modal-mask":{"":{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",alignItems:"center",justifyContent:"center",zIndex:9999}},"modal-content":{"":{width:"558rpx",backgroundColor:"#ffffff",borderRadius:"32rpx",paddingTop:"80rpx",paddingRight:"80rpx",paddingBottom:"80rpx",paddingLeft:"80rpx",alignItems:"center"}},"modal-title":{"":{fontSize:"64rpx",fontWeight:"600",color:"#333333",marginBottom:"80rpx",textAlign:"center"}},"modal-text":{"":{fontSize:"56rpx",color:"#666666",lineHeight:"80rpx",marginBottom:"80rpx",textAlign:"center"}},"modal-btn-wrap":{"":{width:"558rpx",alignItems:"center"}},"modal-btn":{"":{width:"478rpx",height:"152rpx",borderRadius:"76rpx",borderWidth:0,alignItems:"center",justifyContent:"center"}},"confirm-btn":{"":{backgroundColor:"#1ec870"}},"modal-btn-text":{"":{color:"#ffffff",fontSize:"64rpx"}},"modal-cancel":{"":{marginTop:"64rpx",fontSize:"56rpx",color:"#999999"}}},h=O(K,[["styles",[X]]]);var k=plus.webview.currentWebview();if(k){let t=parseInt(k.id),o="pages/login/index",n={};try{n=JSON.parse(k.__query__)}catch(i){}h.mpType="page";let s=Vue.createPageApp(h,{$store:getApp({allowDefault:!0}).$store,__pageId:t,__pagePath:o,__pageQuery:n});s.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...h.styles||[]])),s.mount("#root")}})();
